=====================================
REAL-TIME CHAT DEPLOYMENT GUIDE
=====================================

STEP 1: GET FREE REDIS (REQUIRED for Production)
-------------------------------------------------

Option A: Redis Cloud (Recommended - Easy)
✓ Visit: https://redis.com/try-free/
✓ Sign up for free account (30MB free forever)
✓ Create new database
✓ Copy connection string (format: redis://default:password@host:port)

Option B: Upstash Redis (Alternative)
✓ Visit: https://upstash.com/
✓ Sign up and create Redis database
✓ Copy connection string (format: rediss://default:password@host:port)
✓ Note: Uses 'rediss://' (with SSL)

Option C: Render Redis (If using Render for hosting)
✓ Create Redis instance in Render dashboard
✓ Copy internal connection URL


STEP 2: GET FREE POSTGRESQL (For Production)
---------------------------------------------

Option A: Neon (Already configured in your .env)
✓ Visit: https://neon.tech/
✓ Your DATABASE_URL is already set

Option B: Render PostgreSQL
✓ Visit: https://render.com/
✓ Create PostgreSQL database
✓ Copy connection string

Option C: Supabase
✓ Visit: https://supabase.com/
✓ Create project → Settings → Database
✓ Copy connection pooling URL


STEP 3: DEPLOYMENT PLATFORMS
-----------------------------

Recommended: Render.com (Free Tier)
------------------------------------
1. Backend (Django):
   - Create new "Web Service"
   - Connect your GitHub repo
   - Build Command: pip install -r requirements.txt
   - Start Command: daphne -b 0.0.0.0 -p $PORT core.asgi:application
   - Add Environment Variables:
     * SECRET_KEY=<generate-50-char-random-string>
     * DEBUG=False
     * DATABASE_URL=<your-postgresql-url>
     * REDIS_URL=<your-redis-url>
     * ALLOWED_HOSTS=your-app.onrender.com
     * CORS_ALLOWED_ORIGINS=https://your-frontend.vercel.app

2. Frontend (React):
   - Deploy to Vercel (free)
   - Visit: https://vercel.com/
   - Import your GitHub repo → frontend folder
   - Add Environment Variables:
     * REACT_APP_API_URL=https://your-backend.onrender.com
     * REACT_APP_WS_URL=wss://your-backend.onrender.com


STEP 4: ENVIRONMENT VARIABLES FOR PRODUCTION
---------------------------------------------

Backend (.env on Render/Railway/Heroku):
-----------------------------------------
SECRET_KEY=your-50-character-secret-key-here-use-random-string
DEBUG=False
DATABASE_URL=postgresql://user:pass@host/dbname
REDIS_URL=redis://default:password@host:port
ALLOWED_HOSTS=your-backend.onrender.com,localhost
CORS_ALLOWED_ORIGINS=https://your-frontend.vercel.app,http://localhost:3000

Frontend (.env.production on Vercel):
--------------------------------------
REACT_APP_API_URL=https://your-backend.onrender.com
REACT_APP_WS_URL=wss://your-backend.onrender.com


STEP 5: PRE-DEPLOYMENT CHECKLIST
---------------------------------
✓ Redis URL added to environment variables
✓ PostgreSQL URL configured
✓ SECRET_KEY is strong (50+ random characters)
✓ DEBUG=False in production
✓ ALLOWED_HOSTS includes your domain
✓ CORS_ALLOWED_ORIGINS includes frontend URL
✓ Frontend .env.production points to backend URL
✓ Use wss:// (not ws://) for WebSocket in production
✓ Use https:// (not http://) for API in production


STEP 6: TEST LOCALLY WITH REDIS (Optional)
-------------------------------------------
1. Install Redis locally:
   - Windows: Download from https://github.com/microsoftarchive/redis/releases
   - Or use Docker: docker run -d -p 6379:6379 redis

2. Update your .env:
   REDIS_URL=redis://localhost:6379/0

3. Restart Django server
4. Check console for: "Production: Use Redis Channel Layer"


STEP 7: VERIFY DEPLOYMENT
--------------------------
After deployment, test:
✓ Can register new users
✓ Can login successfully
✓ Can search for users
✓ WebSocket connects (check browser console)
✓ Real-time messages work
✓ Messages persist after refresh
✓ Multiple users can chat simultaneously


TROUBLESHOOTING
---------------
Issue: WebSocket not connecting
→ Ensure REDIS_URL is set correctly
→ Check WebSocket URL uses wss:// in production
→ Verify ALLOWED_WEBSOCKET_ORIGINS in settings.py

Issue: 401 Unauthorized errors
→ Check token is saved in localStorage
→ Verify API interceptor is adding Authorization header
→ Check CORS settings allow credentials

Issue: Messages not appearing
→ Check Redis connection in Django logs
→ Verify both users are connected to WebSocket
→ Check browser console for WebSocket errors


FREE REDIS PROVIDERS COMPARISON
--------------------------------
Redis Cloud:    30MB free, easy setup, reliable
Upstash:        10K commands/day free, serverless, global
Render Redis:   25MB free, integrated with Render hosting


ESTIMATED COSTS (Free Tier Limits)
-----------------------------------
Backend (Render):     Free (sleeps after 15min inactivity)
Frontend (Vercel):    Free (100GB bandwidth/month)
Database (Neon):      Free (10GB storage)
Redis (Redis Cloud):  Free (30MB memory)

TOTAL: $0/month for hobby projects!


SCALING CONSIDERATIONS
----------------------
Free tier limitations:
- Backend sleeps after inactivity (15-30 second cold start)
- Redis memory limited (30MB = ~10K messages)
- Database storage limited (10GB)

For production apps, upgrade to:
- Render: $7/month (no sleep)
- Redis: $5/month (250MB)
- Neon: $19/month (unlimited)


SUPPORT RESOURCES
-----------------
Django Channels: https://channels.readthedocs.io/
Redis Config: https://redis.io/docs/connect/
Render Docs: https://render.com/docs
Vercel Docs: https://vercel.com/docs

Your project is production-ready once Redis is configured!
